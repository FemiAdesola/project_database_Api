<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Project database API</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Project database API</a>
    </div>
  </nav>
 <main class="container text-center my-5 col-md-6">
  <div class="container">

    <!-- Login -->
    <div class="card mb-4 shadow">
      <div class="card-header bg-primary text-white">Login</div>
      <div class="card-body">
        <form id="loginForm" class="row g-3">
          <div class="col-md-6">
            <input type="email" id="email" class="form-control" placeholder="Email" required>
          </div>
          <div class="col-md-6">
            <input type="password" id="password" class="form-control" placeholder="Password" required>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-primary">Login</button>
          </div>
        </form>
        <pre id="output" class="mt-3 text-start bg-light p-2 border rounded"></pre>
      </div>
    </div>

    <!-- Get Projects -->
    <div class="card mb-4 shadow">
      <div class="card-header bg-success text-white">View Projects</div>
      <div class="card-body">
        <button id="getProjects" class="btn btn-success mb-3">Get Projects</button>
        <pre id="projects" class="mt-3 text-start bg-light p-2 border rounded"></pre>
      </div>
    </div> 

    <!-- Add Project -->
    <div class="card mb-4 shadow">
      <div class="card-header bg-info text-white"> Add Project (Admin)</div>
      <div class="card-body">
        <form id="addProjectForm" class="row g-3">
          <div class="col-md-6">
            <input type="text" id="title" class="form-control" placeholder="Title" required>
          </div>
          <div class="col-md-6">
            <input type="text" id="description" class="form-control" placeholder="Description">
          </div>
          <div class="col-md-6">
            <input type="text" id="status" class="form-control" placeholder="Status (planned, in-progress, completed)">
          </div>
          <div class="col-md-3">
            <input type="date" id="startDate" class="form-control">
          </div>
          <div class="col-md-3">
            <input type="date" id="endDate" class="form-control">
          </div>
          <div class="col-12">
            <input type="text" id="members" class="form-control" placeholder="Member IDs (comma separated)">
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-info text-white">Add Project</button>
          </div>
        </form>
        <pre id="addProjectOutput" class="mt-3 text-start bg-light p-2 border rounded"></pre>
      </div>
    </div>

    <!-- Update Project -->
    <div class="card mb-4 shadow">
      <div class="card-header bg-warning text-dark">Update Project (Admin)</div>
      <div class="card-body">
        <form id="updateProjectForm" class="row g-3 ">
          <div class="col-md-12">
            <input type="text" id="updateId" class="form-control" placeholder="Project ID (Mongo _id)" required>
          </div>
          <div class="col-md-6">
            <input type="text" id="updateTitle" class="form-control" placeholder="New Title">
          </div>
          <div class="col-md-6">
            <input type="text" id="updateDescription" class="form-control" placeholder="New Description">
          </div>
          <div class="col-md-6">
            <input type="text" id="updateStatus" class="form-control" placeholder="New Status">
          </div>
          <div class="col-md-6">
            <input type="text" id="updateMembers" class="form-control" placeholder="Member IDs (comma separated)">
            </div>
          <div class="col-md-3">
            <input type="date" id="updateStartDate" class="form-control">
          </div>
          <div class="col-md-3">
            <input type="date" id="updateEndDate" class="form-control">
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-warning text-dark">Update Project</button>
          </div>
        </form>
        <pre id="updateProjectOutput" class="mt-3 text-start bg-light p-2 border rounded"></pre>
      </div>
    </div>

  </div>
  </main>

  <script>
    let token = null; // store JWT

    // --- LOGIN ---
    document.getElementById("loginForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const res = await fetch("https://project-database-api.onrender.com/api/auth/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });

      const data = await res.json();
      document.getElementById("output").textContent = JSON.stringify(data, null, 2);

      if (data.token) {
        token = data.token;
        alert("Login successful! Token saved.");
      } else {
        alert("Login failed!");
      }
    });

    // --- GET PROJECTS ---
    document.getElementById("getProjects").addEventListener("click", async () => {
      if (!token) {
        alert("Please login first!");
        return;
      }

      const res = await fetch("https://project-database-api.onrender.com/api/projects", {
        headers: { "Authorization": "Bearer " + token }
      });

      const projects = await res.json();
      document.getElementById("projects").textContent = JSON.stringify(projects, null, 2);
    });

    // --- ADD PROJECT ---
    document.getElementById("addProjectForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!token) {
        alert("Please login first!");
        return;
      }

      const members = document.getElementById("members").value
        .split(",")
        .map(m => m.trim())
        .filter(m => m);

      const body = {
        title: document.getElementById("title").value,
        description: document.getElementById("description").value,
        status: document.getElementById("status").value || "planned",
        startDate: document.getElementById("startDate").value || null,
        endDate: document.getElementById("endDate").value || null,
        members: members
      };

      const res = await fetch("https://project-database-api.onrender.com/api/projects", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      document.getElementById("addProjectOutput").textContent = JSON.stringify(data, null, 2);
    });

    // --- UPDATE PROJECT ---
    document.getElementById("updateProjectForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      if (!token) {
        alert("Please login first!");
        return;
      }

      const id = document.getElementById("updateId").value;
      // Get members from input (comma-separated) and convert to array
      const membersInput = document.getElementById("updateMembers").value;
      const members = membersInput
        .split(",")
        .map(m => m.trim())
        .filter(m => m);

      const body = {
        title: document.getElementById("updateTitle").value || undefined,
        description: document.getElementById("updateDescription").value || undefined,
        status: document.getElementById("updateStatus").value || undefined,
        startDate: document.getElementById("updateStartDate").value || undefined,
        endDate: document.getElementById("updateEndDate").value || undefined,
        members: members.length > 0 ? members : undefined
      };

      const res = await fetch("https://project-database-api.onrender.com/api/projects/" + id, {
        method: "PUT",
        headers: {
          "Authorization": "Bearer " + token,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });

      const data = await res.json();
      document.getElementById("updateProjectOutput").textContent = JSON.stringify(data, null, 2);
    });
  </script>

</body>
</html>
